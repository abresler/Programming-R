library(ggplot2)

mpg

p <- ggplot(data=mpg, mapping=aes(x=cty , y=hwy))
p + geom_point()

summary(p)

summary(p + geom_point())



p <- ggplot(mpg, aes(x=cty , y=hwy , colour=factor(year)))
p
p + geom_point()
p + geom_point() + stat_smooth()


p <- ggplot(mpg, aes(x=cty,y=hwy))
p + geom_point(aes(colour=factor(year)))+
  stat_smooth() 


p <- ggplot(mpg, aes(x=cty,y=hwy))
p + geom_point(aes(colour=factor(year)))+
  stat_smooth()

d <- ggplot() +
  geom_point(data=mpg,  aes(x=cty , y=hwy, colour=factor(year)))+
  stat_smooth(data=mpg,  aes(x=cty , y=hwy))
print(d)


summary(d)



#??????????????????????????????
p + geom_point(aes(colour=factor(year)))+
  stat_smooth()+ 
  scale_color_manual(values =c('blue','red'))


p + geom_point(aes(colour=factor(year),size=displ))+
  stat_smooth()+
  scale_color_manual(values =c('blue2','red4')) 


p + geom_point(aes(colour=factor(year),size=displ),
               alpha=0.5,position = "jitter") +  stat_smooth()+
  scale_color_manual(values =c('blue2','red4'))+
  scale_size_continuous(range = c(4, 10)) 


p + geom_point(aes(colour=factor(year),size=displ),
               alpha=0.5,position = "jitter")+  stat_smooth()+
  scale_color_manual(values =c('blue2','red4'))+
  scale_size_continuous(range = c(4, 10))+
  coord_cartesian(xlim = c(15, 25),ylim=c(15,40))



#??????facet?????????????????????????????????
p + geom_point(aes(colour=class, size=displ),
                alpha=0.5, position = "jitter")+  stat_smooth()+
  scale_size_continuous(range = c(4, 10))+
  facet_wrap(~ year, ncol=1) 


#?????????????????????????????????
 p <- ggplot(mpg, aes(x=cty , y=hwy))
 p + geom_point(aes(colour=class,size=displ),
                 alpha=0.5,position = "jitter")+
  stat_smooth()+
  scale_size_continuous(range = c(4, 10))+
  facet_wrap(~ year,ncol=1)+
  opts(title='?????????????????????')+
  labs(y='?????????????????????????????????',
       x='?????????????????????????????????')+
  guides(size=guide_legend(title='??????'),
         colour = guide_legend(title='??????',
                               override.aes=list(size=5))) 


#?????????
p <- ggplot(mpg,aes(x=hwy))
p + geom_histogram() 


#?????????????????????????????????????????????????????????
summary(p + geom_histogram())



p + geom_histogram(aes(fill=factor(year),y=..density..), alpha=0.3,colour='black')+
  stat_density(geom='line',position='identity',size=1.5, aes(colour=factor(year)))+
  facet_wrap(~year,ncol=1) 


#?????????
p <- ggplot(mpg, aes(x=class)) 
p + geom_bar() 



class2 <- mpg$class; class2 <- reorder(class2,class2,length)
mpg$class2 <-  class2
P <-  ggplot(mpg, aes(x=class2))
p +  geom_bar(aes(fill=class2))


#????????????????????????????????????position????????????????????????
p <- ggplot(mpg, aes(class2,fill=factor(year)))
p + geom_bar(position='identity',alpha=0.5) 


#????????????
p + geom_bar(position='dodge') 
#????????????
p+geom_bar(position='stack') 
#????????????
p+geom_bar(position='fill')
#????????????
p+ geom_bar(aes(fill=class2))+facet_wrap(~year) 




#??????
p <- ggplot(mpg, aes(x = factor(1), fill = factor(class))) +
  geom_bar(width = 1)
p + coord_polar(theta = "y")



#?????????
p <- ggplot(mpg, aes(class,hwy,fill=class))
p+geom_boxplot() 



p + geom_violin(alpha=0.3,width=0.9)+
  geom_jitter(shape=21) 



p <- ggplot(diamonds,aes(carat,price))
p + geom_point() 


##???????????????????????????
##??? ???????????? ???jitter???
##??? ??????????????? ???alpha???
##??? ??????????????? ???stat_bin2d???
##??? ????????? ???stat_density2d??? 

p + stat_bin2d(bins = 60)

p + stat_density2d(aes(fill = ..level..), geom="polygon") +
  coord_cartesian(xlim  = c(0, 1.5),ylim=c(0,6000))+
  scale_fill_continuous(high='red2',low='blue4') 


##????????????
##??? ????????????
##??? ??????????????????
##??? ????????????
##??? ???????????????
##??? OpenStreetMap
##??? ???????????? 


#????????????????????? 

#????????????100????????????????????????16????????????
dir <- cut_interval(runif(100,0,360),n=16)

#????????????100????????????????????????4?????????
mag <- cut_interval(rgamma(100,15),4) 
sample <- data.frame(dir=dir,mag=mag)

#??????????????????X?????????????????????Y???????????????????????????
#????????????????????????????????????????????????????????????
p <-  ggplot(sample,aes(x=dir,y=..count..,fill=mag))
p + geom_bar()+ coord_polar() 


#????????????
library(quantmod)
library(ggplot2)
getSymbols('^SSEC',src='yahoo',from = '1997-01-01')
close <- (Cl(SSEC))
time <- index(close)
value <- as.vector(close)
yrng <- range(value)
xrng <- range(time)
data <- data.frame(start=as.Date(c('1997-01-01','2003-01-01')),end=as.Date(c('2002-12-30','2012-01-20')),core=c('jiang','hu'))
timepoint <- as.Date(c('1999-07-02','2001-07-26','2005-04-29','2008-01-10','2010-03-31'))
events <- c('???????????????','???????????????','??????????????????','??????????????????','???????????????
???')
data2 <- data.frame(timepoint,events,stock=value[time %in% timepoint])
p <- ggplot(data.frame(time,value),aes(time,value))
p + geom_line(size=1,colour='turquoise4')+
  geom_rect(alpha=0.2,aes(NULL,NULL,xmin  = start, xmax = end, fill = core),ymin  = 
              yrng[1],ymax=yrng[2],data = data)+
  scale_fill_manual(values = c('blue','red'))+
  geom_text(aes(timepoint, stock, label = events),data = data2,vjust = -2,size = 5)+
  geom_point(aes(timepoint, stock),data = data2,size = 5,colour = 'red',alpha=0.5)



#???????????????
library(ggplot2)
library(gpclib)
library(maptools)
load(url("http://gadm.org/data/rda/CHN_adm1.RData"))
water <- c(1085,325,1473,3524,1079,2935,3989,2790,4147,358,2046,434
           ,1652,2490,451,3362,1467,871,2145,182,1000,12278,448,377,
           182,1221,3135,152,4976,10000,5298,2005)
gpclibPermit()
china.map  <-  fortify(gadm,region='ID_1')
vals  <-  data.frame(id =unique(china.map$id),val=water)
ggplot(vals, aes(map_id = id)) + 
  geom_map(aes(fill = val), map =china.map) +
  expand_limits(x = china.map$long, y = china.map$lat) +
  scale_fill_continuous(limits=c(0,2200),low = 'red2',high ='yellow',
                        guide = "colorbar") + 
  opts(title='??????????????????????????????',
       axis.line=theme_blank(),axis.text.x=theme_blank(),
       axis.text.y=theme_blank(),axis.ticks=theme_blank(),
       axis.title.x=theme_blank(),
       axis.title.y=theme_blank()) +
  xlab("") + ylab("") 














